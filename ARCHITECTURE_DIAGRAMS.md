# ğŸ¯ System Architecture Diagram

## End-to-End Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (React/Next.js)                      â”‚
â”‚                   monitoring/page.tsx                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Video Grid Display (3 cameras)                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ Gate 1  â”‚  â”‚ Main    â”‚  â”‚Parking  â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ ğŸ¥ Live â”‚  â”‚ Hall    â”‚  â”‚ ğŸ”´ Off  â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ ğŸŸ¢ 95%  â”‚  â”‚ ğŸ¥ Live â”‚  â”‚         â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ Normal  â”‚  â”‚ ğŸ”´ 78%  â”‚  â”‚         â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ Panic   â”‚  â”‚ Panic   â”‚  â”‚         â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚ Every 500ms                           â”‚
â”‚                          â†“                                       â”‚
â”‚                    Canvas Capture                                â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â†“                                       â”‚
â”‚              POST /api/inference/lstm-panic-detect               â”‚
â”‚              (multipart: frame, camera_id, event_id)             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  liveEnable Toggle: "Enable Claude Haiku 4.5..."     â”‚       â”‚
â”‚  â”‚  â–¡ Status Filter: All / Live / Offline              â”‚       â”‚
â”‚  â”‚  âœ“ Real-time UI Updates                             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP POST
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 BACKEND API (Express.js)                         â”‚
â”‚                   server.js (port 5001)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€ Middleware â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ â€¢ CORS enabled                                        â”‚       â”‚
â”‚  â”‚ â€¢ Express JSON parser                                â”‚       â”‚
â”‚  â”‚ â€¢ Multer for file uploads                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€ inferenceRoutes.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ POST /lstm-panic-detect                              â”‚       â”‚
â”‚  â”‚ GET /history/:camera_id                              â”‚       â”‚
â”‚  â”‚ GET /stats/:event_id                                 â”‚       â”‚
â”‚  â”‚ DELETE /clear-buffer/:camera_id                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€ inferenceController.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Frame received (JPEG blob)                            â”‚       â”‚
â”‚  â”‚         â”‚                                             â”‚       â”‚
â”‚  â”‚         â†“                                             â”‚       â”‚
â”‚  â”‚ Extract Features (spawn Python)                      â”‚       â”‚
â”‚  â”‚   â€¢ Motion Energy (Laplacian)                        â”‚       â”‚
â”‚  â”‚   â€¢ Flux of Count (Contours)                         â”‚       â”‚
â”‚  â”‚         â”‚                                             â”‚       â”‚
â”‚  â”‚         â†“                                             â”‚       â”‚
â”‚  â”‚ Update Temporal Buffer                               â”‚       â”‚
â”‚  â”‚   â€¢ Circular 30-step sequence                        â”‚       â”‚
â”‚  â”‚   â€¢ Normalize features                               â”‚       â”‚
â”‚  â”‚         â”‚                                             â”‚       â”‚
â”‚  â”‚         â†“                                             â”‚       â”‚
â”‚  â”‚ Run LSTM Inference (spawn Python)                    â”‚       â”‚
â”‚  â”‚   â€¢ Predict panic probability                        â”‚       â”‚
â”‚  â”‚   â€¢ Return confidence score                          â”‚       â”‚
â”‚  â”‚         â”‚                                             â”‚       â”‚
â”‚  â”‚         â†“                                             â”‚       â”‚
â”‚  â”‚ Create Alert if needed                               â”‚       â”‚
â”‚  â”‚   â€¢ Confidence > 0.75                                â”‚       â”‚
â”‚  â”‚   â€¢ Prevent duplicates (10s window)                  â”‚       â”‚
â”‚  â”‚         â”‚                                             â”‚       â”‚
â”‚  â”‚         â†“                                             â”‚       â”‚
â”‚  â”‚ Save to MongoDB                                      â”‚       â”‚
â”‚  â”‚ Return: {panic_detected, confidence, timestamp}     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                          â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP Response (JSON)
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DATABASE (MongoDB)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€ PanicDetection Collection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ {                                                      â”‚      â”‚
â”‚  â”‚   cameraId: "cam_001",                               â”‚      â”‚
â”‚  â”‚   panicDetected: true,                               â”‚      â”‚
â”‚  â”‚   confidence: 0.87,                                  â”‚      â”‚
â”‚  â”‚   motionEnergy: 45.2,                                â”‚      â”‚
â”‚  â”‚   fluxOfCount: 23,                                   â”‚      â”‚
â”‚  â”‚   alertId: ObjectId(...),    â† Links to Alert       â”‚      â”‚
â”‚  â”‚   timestamp: ISODate(...)                            â”‚      â”‚
â”‚  â”‚ }                                                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ Alert Collection (auto-created) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ {                                                      â”‚      â”‚
â”‚  â”‚   zone: "cam_001",                                   â”‚      â”‚
â”‚  â”‚   alertType: "DANGER",                               â”‚      â”‚
â”‚  â”‚   riskLevel: "YELLOW" or "RED",                      â”‚      â”‚
â”‚  â”‚   message: "Panic detected at camera...",            â”‚      â”‚
â”‚  â”‚   timestamp: ISODate(...)                            â”‚      â”‚
â”‚  â”‚ }                                                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€ Camera Collection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ {                                                      â”‚      â”‚
â”‚  â”‚   cameraId: "cam_001",                               â”‚      â”‚
â”‚  â”‚   location: "Gate 1 Entrance",                        â”‚      â”‚
â”‚  â”‚   streamUrl: "https://...",                          â”‚      â”‚
â”‚  â”‚   status: "Live",                                    â”‚      â”‚
â”‚  â”‚   panicDetectionHistory: [...]                       â”‚      â”‚
â”‚  â”‚ }                                                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Query Results
                            â†“
                      Python ML Pipeline
```

---

## Python ML Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          extract_features.py                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚  Input: Frame bytes (JPEG)                              â”‚
â”‚     â†“                                                    â”‚
â”‚  Decode image with OpenCV                               â”‚
â”‚     â†“                                                    â”‚
â”‚  Convert to grayscale                                   â”‚
â”‚     â†“                                                    â”‚
â”‚  â”Œâ”€ Motion Energy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Apply Laplacian edge detection    â”‚                   â”‚
â”‚  â”‚ Sum absolute values               â”‚                   â”‚
â”‚  â”‚ Normalize by image size           â”‚                   â”‚
â”‚  â”‚ Output: Float (0-100+)            â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚     â†“                                                    â”‚
â”‚  â”Œâ”€ Flux of Count â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Apply Gaussian blur               â”‚                   â”‚
â”‚  â”‚ Binary threshold                  â”‚                   â”‚
â”‚  â”‚ Find contours (morphological)     â”‚                   â”‚
â”‚  â”‚ Count contours                    â”‚                   â”‚
â”‚  â”‚ Output: Int (people count)        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚     â†“                                                    â”‚
â”‚  Return: {motionEnergy: float, fluxOfCount: int}        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Circular Buffer         â”‚
        â”‚  (per camera)             â”‚
        â”‚  [30 time steps]          â”‚
        â”‚  Last: [ME, FC]           â”‚
        â”‚  Remove oldest when full  â”‚
        â”‚                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“ (when buffer has 30 steps)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          run_inference.py                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚  Input: [motion_energy], [flux_of_count]                â”‚
â”‚     â†“                                                    â”‚
â”‚  Normalize features (z-score)                            â”‚
â”‚     â†“                                                    â”‚
â”‚  Stack into (30, 2) matrix                              â”‚
â”‚     â†“                                                    â”‚
â”‚  Reshape to (1, 30, 2) - batch dimension                â”‚
â”‚     â†“                                                    â”‚
â”‚  Load panic_lstm_model.h5                               â”‚
â”‚     â†“                                                    â”‚
â”‚  â”Œâ”€ LSTM Architecture â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚                             â”‚                         â”‚
â”‚  â”‚  Input: (1, 30, 2)         â”‚                         â”‚
â”‚  â”‚    â†“                        â”‚                         â”‚
â”‚  â”‚  LSTM(64) + Dropout(0.2)   â”‚                         â”‚
â”‚  â”‚    â†“                        â”‚                         â”‚
â”‚  â”‚  LSTM(32) + Dropout(0.2)   â”‚                         â”‚
â”‚  â”‚    â†“                        â”‚                         â”‚
â”‚  â”‚  Dense(16, relu)            â”‚                         â”‚
â”‚  â”‚    â†“                        â”‚                         â”‚
â”‚  â”‚  Dense(1, sigmoid)         â”‚                         â”‚
â”‚  â”‚    â†“                        â”‚                         â”‚
â”‚  â”‚  Output: (1, 1) âˆˆ [0, 1]   â”‚                         â”‚
â”‚  â”‚                             â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚     â†“                                                    â”‚
â”‚  Output: {                                              â”‚
â”‚    panic_detected: confidence > 0.5,                    â”‚
â”‚    confidence: float âˆˆ [0, 1],                          â”‚
â”‚    threshold: 0.5                                       â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            Response â†’ Frontend
            Display â†’ UI Update
```

---

## Frontend Real-time Update Flow

```
Response Received: {panic_detected, confidence, timestamp}
         â”‚
         â†“
setDetections(prev => ({
  ...prev,
  [videoId]: {
    panicDetected,
    confidence,
    timestamp
  }
}))
         â”‚
         â†“
â”Œâ”€ Component Re-render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚
â”‚  Detection State Updated              â”‚
â”‚  detection = {                        â”‚
â”‚    panicDetected: true,               â”‚
â”‚    confidence: 0.87,                  â”‚
â”‚    timestamp: "..."                   â”‚
â”‚  }                                    â”‚
â”‚                                       â”‚
â”‚  Detection Component Updates:         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ IF panicDetected:               â”‚ â”‚
â”‚  â”‚   Background: RED (#EF4444)    â”‚ â”‚
â”‚  â”‚   Icon: âš ï¸ AlertTriangle        â”‚ â”‚
â”‚  â”‚   Text: "Panic ({confidence}%)"â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ ELSE:                           â”‚ â”‚
â”‚  â”‚   Background: GREEN (#22C55E)   â”‚ â”‚
â”‚  â”‚   Icon: âœ“ Activity              â”‚ â”‚
â”‚  â”‚   Text: "Normal ({confidence}%)"â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ Confidence: Math.round(         â”‚ â”‚
â”‚  â”‚   confidence * 100              â”‚ â”‚
â”‚  â”‚ ) + "%"                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚
â”‚  UI Updated Instantly                 â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    User sees:
    [ğŸ¥] Gate 1
    Status: Live
    
    ğŸ”´ Panic (87%)    â† RED badge with icon
    
    [Fullscreen] [Scan]
```

---

## Temporal Buffering Strategy

```
Time Series: Motion & Crowd Data
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Frame 1:   ME=45, FC=12  â†’ Buffer: [45, 12]
Frame 2:   ME=47, FC=14  â†’ Buffer: [45, 47], [12, 14]
Frame 3:   ME=46, FC=13  â†’ Buffer: [45, 47, 46], [12, 14, 13]
...
Frame 30:  ME=52, FC=18  â†’ Buffer (full): 30 values in each

Frame 31:  ME=48, FC=15  â†’ Buffer (rotate):
           Remove first (45, 12)
           Add new (48, 15)
           New Buffer: [47, 46, ..., 52, 48], [14, 13, ..., 18, 15]
           
           Ready for LSTM!
           Input shape: (30, 2) âœ“
           â†’ Run inference
           â†’ Get panic probability
           â†’ Update UI


Circular Buffer Advantages:
â€¢ Always maintain recent 30 frames
â€¢ Automatic memory management
â€¢ No array copying (shift/unshift)
â€¢ Ready for LSTM when full
```

---

## API Request/Response Cycle

```
FRONTEND                          BACKEND                   DATABASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User toggles 
liveEnable âœ“
    â”‚
    â”œâ”€ setInterval(500ms)
    â”‚
    â”œâ”€ Canvas.captureFrame()
    â”‚
    â”œâ”€ canvas.toBlob()
    â”‚
    â””â”€ POST /api/inference/lstm-panic-detect
       â”‚
       â”‚ Multipart Form Data:
       â”‚ â€¢ frame: Blob
       â”‚ â€¢ camera_id: "cam_001"
       â”‚ â€¢ event_id: "evt_001"
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Receive request
       â”‚                             â”‚
       â”‚                             â”œâ”€ Parse multipart
       â”‚                             â”œâ”€ Extract frame buffer
       â”‚                             â”‚
       â”‚                             â”œâ”€ Create temporal buffer
       â”‚                             â”‚
       â”‚                             â”œâ”€ Spawn extract_features.py
       â”‚                             â”‚   â”œâ”€ Motion energy
       â”‚                             â”‚   â””â”€ Flux of count
       â”‚                             â”‚
       â”‚                             â”œâ”€ Append to buffer
       â”‚                             â”‚
       â”‚                             â”œâ”€ If buffer.length >= 30:
       â”‚                             â”‚   â”œâ”€ Normalize features
       â”‚                             â”‚   â”œâ”€ Spawn run_inference.py
       â”‚                             â”‚   â””â”€ Get confidence
       â”‚                             â”‚
       â”‚                             â”œâ”€ Save to PanicDetection â”€â”€â”€â”€â”€â”€â†’ Create record
       â”‚                             â”‚                                 â”‚
       â”‚                             â”œâ”€ If confidence > 0.75:        â”‚
       â”‚                             â”‚   â””â”€ Create Alert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Create alert
       â”‚                             â”‚                                 â”‚
       â”‚                             â””â”€ Return JSON response
       â”‚
       â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       {
         "panic_detected": true,
         "confidence": 0.87,
         "timestamp": "2024-01-20T...",
         "detection_id": "..."
       }
       â”‚
       â””â”€ setDetections(state)
          â”‚
          â””â”€ Component re-renders
             â”‚
             â””â”€ Update UI badge
                â”œâ”€ Color: RED
                â”œâ”€ Icon: âš ï¸
                â””â”€ Text: "Panic (87%)"
                
             âœ… User sees real-time update!
```

---

## Component Hierarchy

```
MonitoringPage
â”‚
â”œâ”€ Header Section
â”‚  â”œâ”€ Title: "ğŸ¥ Monitoring"
â”‚  â”œâ”€ Description
â”‚  â””â”€ Controls
â”‚     â”œâ”€ liveEnable Toggle
â”‚     â”‚  â””â”€ setLiveEnable(boolean)
â”‚     â”‚     â””â”€ Start/stop inference intervals
â”‚     â”‚
â”‚     â””â”€ Filter Dropdown
â”‚        â””â”€ setFilter(All|Live|Offline)
â”‚           â””â”€ Filter videos array
â”‚
â”œâ”€ Video Grid (filteredVideos.map())
â”‚  â”‚
â”‚  â””â”€ Video Card (Ã—N)
â”‚     â”œâ”€ Card Container
â”‚     â”‚  â””â”€ bg-slate-900
â”‚     â”‚
â”‚     â”œâ”€ CardHeader
â”‚     â”‚  â”œâ”€ Title + Icon
â”‚     â”‚  â”œâ”€ Location info
â”‚     â”‚  â”œâ”€ Status badge
â”‚     â”‚  â”‚  â””â”€ Green (Live) or Red (Offline)
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€ Detection Indicator
â”‚     â”‚     â”œâ”€ IF liveEnable && detection exists:
â”‚     â”‚     â”‚  â”œâ”€ Panic: Red badge + âš ï¸ icon
â”‚     â”‚     â”‚  â””â”€ Normal: Green badge + âœ“ icon
â”‚     â”‚     â”‚
â”‚     â”‚     â””â”€ Confidence: {confidence * 100}%
â”‚     â”‚
â”‚     â”œâ”€ CardContent
â”‚     â”‚  â”œâ”€ Video element
â”‚     â”‚  â”‚  â””â”€ onClick â†’ Fullscreen
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€ Buttons
â”‚     â”‚     â”œâ”€ Fullscreen button
â”‚     â”‚     â””â”€ [Scan button - optional]
â”‚     â”‚
â”‚     â””â”€ useRef for:
â”‚        â”œâ”€ videoRefs[id]
â”‚        â”œâ”€ canvasRefs[id]
â”‚        â””â”€ inferenceIntervalRefs[id]
â”‚
â””â”€ Fullscreen Modal (if selectedVideo !== null)
   â”œâ”€ Fixed overlay
   â”œâ”€ Video element (large)
   â”œâ”€ Detection Alert Overlay
   â”‚  â”œâ”€ IF panic: "ğŸš¨ PANIC DETECTED"
   â”‚  â””â”€ IF normal: "âœ… NORMAL"
   â”œâ”€ Confidence score
   â””â”€ Close button
```

---

## Error Handling Flow

```
Frame Processing
       â”‚
       â”œâ”€ No frame? â†’ Return early
       â”‚
       â”œâ”€ Video not ready? â†’ Return early
       â”‚
       â”œâ”€ Canvas context fail? â†’ Log error
       â”‚
       â”œâ”€ Extract features error?
       â”‚  â””â”€ Use default values (0.5 confidence)
       â”‚
       â”œâ”€ Inference error?
       â”‚  â””â”€ Use threshold-based detection
       â”‚
       â”œâ”€ Database write error?
       â”‚  â””â”€ Queue for retry
       â”‚
       â”œâ”€ Alert creation error?
       â”‚  â””â”€ Log and continue
       â”‚
       â””â”€ API error?
          â””â”€ Try-catch with console log
```

---

This architecture ensures:
âœ… Real-time responsiveness
âœ… Graceful error handling
âœ… Scalable multi-camera support
âœ… Efficient temporal buffering
âœ… Persistent data storage
âœ… Seamless UI updates
