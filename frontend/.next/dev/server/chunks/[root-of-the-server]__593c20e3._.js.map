{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/indra_netra/frontend/app/api/inference/route.ts"],"sourcesContent":["// App Router API endpoint for LSTM panic detection\r\nimport { NextRequest, NextResponse } from 'next/server'\r\n\r\nexport const config = {\r\n  maxDuration: 30,\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log('üîÑ [API] Proxying inference request to backend...')\r\n\r\n    const formData = await request.formData()\r\n    const frame = formData.get('frame') as Blob\r\n    const camera_id = formData.get('camera_id') as string\r\n    const event_id = formData.get('event_id') as string\r\n\r\n    if (!frame) {\r\n      return NextResponse.json(\r\n        { error: 'No frame provided' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    console.log(`üìπ Frame received: ${frame.size} bytes from camera ${camera_id}`)\r\n\r\n    // Create new FormData to send to backend\r\n    const backendFormData = new FormData()\r\n    backendFormData.append('frame', frame)\r\n    backendFormData.append('camera_id', camera_id)\r\n    backendFormData.append('event_id', event_id)\r\n\r\n    // Forward to backend\r\n    const backendUrl = 'http://localhost:5001/api/inference/lstm-panic-detect'\r\n    console.log(`üöÄ Forwarding to: ${backendUrl}`)\r\n\r\n    const response = await fetch(backendUrl, {\r\n      method: 'POST',\r\n      body: backendFormData,\r\n      timeout: 30000, // 30 second timeout\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text()\r\n      console.error(`‚ùå Backend error ${response.status}: ${errorText}`)\r\n      return NextResponse.json(\r\n        { \r\n          error: 'Backend inference failed',\r\n          status: response.status,\r\n          details: errorText \r\n        },\r\n        { status: response.status }\r\n      )\r\n    }\r\n\r\n    const result = await response.json()\r\n    console.log(`‚úÖ Inference successful - Panic: ${result.panic_detected}, Confidence: ${result.confidence}`)\r\n\r\n    return NextResponse.json(result, { status: 200 })\r\n  } catch (error) {\r\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error'\r\n    console.error(`‚ùå [API] Error: ${errorMessage}`)\r\n    console.error(error)\r\n\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Inference proxy failed',\r\n        message: errorMessage,\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport function OPTIONS() {\r\n  return NextResponse.json({ ok: true })\r\n}\r\n"],"names":[],"mappings":"AAAA,mDAAmD;;;;;;;;;AACnD;;AAEO,MAAM,SAAS;IACpB,aAAa;AACf;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,QAAQ,SAAS,GAAG,CAAC;QAC3B,MAAM,YAAY,SAAS,GAAG,CAAC;QAC/B,MAAM,WAAW,SAAS,GAAG,CAAC;QAE9B,IAAI,CAAC,OAAO;YACV,OAAO,4JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,MAAM,IAAI,CAAC,mBAAmB,EAAE,WAAW;QAE7E,yCAAyC;QACzC,MAAM,kBAAkB,IAAI;QAC5B,gBAAgB,MAAM,CAAC,SAAS;QAChC,gBAAgB,MAAM,CAAC,aAAa;QACpC,gBAAgB,MAAM,CAAC,YAAY;QAEnC,qBAAqB;QACrB,MAAM,aAAa;QACnB,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,YAAY;QAE7C,MAAM,WAAW,MAAM,MAAM,YAAY;YACvC,QAAQ;YACR,MAAM;YACN,SAAS;QACX;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,SAAS,MAAM,CAAC,EAAE,EAAE,WAAW;YAChE,OAAO,4JAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,QAAQ,SAAS,MAAM;gBACvB,SAAS;YACX,GACA;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,QAAQ,GAAG,CAAC,CAAC,gCAAgC,EAAE,OAAO,cAAc,CAAC,cAAc,EAAE,OAAO,UAAU,EAAE;QAExG,OAAO,4JAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IACjD,EAAE,OAAO,OAAO;QACd,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,QAAQ,KAAK,CAAC,CAAC,eAAe,EAAE,cAAc;QAC9C,QAAQ,KAAK,CAAC;QAEd,OAAO,4JAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,SAAS;IACd,OAAO,4JAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC"}}]
}